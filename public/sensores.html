<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="assets/imgs/icon.png" type="image/x-icon">
    <link rel="stylesheet" href="assets/styles/Sensores.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Dashboard</title>
</head>

<body translate="no">
    <div class="coluna">
        <aside>
            <ul>
                <img id="logo" src="assets/imgs/logo-seedtech-branca.svg" alt="">
                <button id="dashboard" class="select-aside" onclick="home()">
                    <svg width="72" height="70" viewBox="0 0 72 70" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M39.7855 4.83419C40.3422 4.91994 40.709 5.45591 40.5979 6.00806L34.8572 34.5306C34.728 35.173 35.2411 35.764 35.8952 35.7263L64.7636 34.06C65.3298 34.0273 65.8108 34.4721 65.8125 35.0393C65.8417 44.6672 63.5417 52.56 56.3006 59.8012C43.6016 72.5002 22.8006 72.5002 10.1986 59.8012C-2.50043 47.1022 -2.50043 26.3012 10.1986 13.6992C18.7418 5.06122 28.6029 3.11165 39.7855 4.83419ZM70.3056 32.1577C70.8557 32.1269 71.2782 31.6528 71.2379 31.1033C70.0512 14.905 61.0384 4.45789 45.084 0.908007C44.5449 0.788053 44.0134 1.13888 43.9044 1.68032L37.6539 32.7328C37.5248 33.3745 38.0367 33.9652 38.6902 33.9286L70.3056 32.1577ZM48.3284 5.80594C47.7763 5.62939 47.2031 5.98262 47.0881 6.55075L42.6585 28.4338C42.5288 29.0745 43.0386 29.6653 43.6914 29.6308L65.9336 28.4546C66.511 28.424 66.944 27.911 66.8526 27.3401C65.2395 17.2688 57.9771 8.89132 48.3284 5.80594ZM12.9998 16.5C1.89777 27.602 1.89777 45.898 12.9998 57C24.1018 68.102 42.3008 68.102 53.3978 57C57.9569 52.4408 61.0716 46.2616 61.6313 39.398C61.6792 38.8106 61.1899 38.3279 60.6013 38.359L30.8889 39.9319C30.2363 39.9665 29.7265 39.3761 29.8558 38.7355L35.7789 9.39159C35.8964 8.80905 35.4826 8.25166 34.8893 8.21822C26.6868 7.75599 18.8389 10.6613 12.9998 16.5Z"
                            fill="black" />
                    </svg>
                    <div class="caixa">
                        <p>Dashboard</p>
                    </div>
                </button>

                <button class="select-aside" onclick="historico()">
                    <svg class="icone" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                        text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                        clip-rule="evenodd" viewBox="0 0 512 513.11">
                        <path fill-rule="nonzero"
                            d="M210.48 160.8c0-14.61 11.84-26.46 26.45-26.46s26.45 11.85 26.45 26.46v110.88l73.34 32.24c13.36 5.88 19.42 21.47 13.54 34.82-5.88 13.35-21.47 19.41-34.82 13.54l-87.8-38.6c-10.03-3.76-17.16-13.43-17.16-24.77V160.8zM5.4 168.54c-.76-2.25-1.23-4.64-1.36-7.13l-4-73.49c-.75-14.55 10.45-26.95 25-27.69 14.55-.75 26.95 10.45 27.69 25l.74 13.6a254.258 254.258 0 0136.81-38.32c17.97-15.16 38.38-28.09 61.01-38.18 64.67-28.85 134.85-28.78 196.02-5.35 60.55 23.2 112.36 69.27 141.4 132.83.77 1.38 1.42 2.84 1.94 4.36 27.86 64.06 27.53 133.33 4.37 193.81-23.2 60.55-69.27 112.36-132.83 141.39a26.24 26.24 0 01-12.89 3.35c-14.61 0-26.45-11.84-26.45-26.45 0-11.5 7.34-21.28 17.59-24.92 7.69-3.53 15.06-7.47 22.09-11.8.8-.66 1.65-1.28 2.55-1.86 11.33-7.32 22.1-15.7 31.84-25.04.64-.61 1.31-1.19 2-1.72 20.66-20.5 36.48-45.06 46.71-71.76 18.66-48.7 18.77-104.46-4.1-155.72l-.01-.03C418.65 122.16 377.13 85 328.5 66.37c-48.7-18.65-104.46-18.76-155.72 4.1a203.616 203.616 0 00-48.4 30.33c-9.86 8.32-18.8 17.46-26.75 27.29l3.45-.43c14.49-1.77 27.68 8.55 29.45 23.04 1.77 14.49-8.55 27.68-23.04 29.45l-73.06 9c-13.66 1.66-26.16-7.41-29.03-20.61zM283.49 511.5c20.88-2.34 30.84-26.93 17.46-43.16-5.71-6.93-14.39-10.34-23.29-9.42-15.56 1.75-31.13 1.72-46.68-.13-9.34-1.11-18.45 2.72-24.19 10.17-12.36 16.43-2.55 39.77 17.82 42.35 19.58 2.34 39.28 2.39 58.88.19zm-168.74-40.67c7.92 5.26 17.77 5.86 26.32 1.74 18.29-9.06 19.97-34.41 3.01-45.76-12.81-8.45-25.14-18.96-35.61-30.16-9.58-10.2-25.28-11.25-36.11-2.39a26.436 26.436 0 00-2.55 38.5c13.34 14.2 28.66 27.34 44.94 38.07zM10.93 331.97c2.92 9.44 10.72 16.32 20.41 18.18 19.54 3.63 36.01-14.84 30.13-33.82-4.66-15-7.49-30.26-8.64-45.93-1.36-18.33-20.21-29.62-37.06-22.33C5.5 252.72-.69 262.86.06 274.14c1.42 19.66 5.02 39 10.87 57.83z" />
                    </svg>
                    <div class="caixa">
                        <p>Hist√≥rico</p>
                    </div>
                </button>

                <button class="select-aside" onclick="cadastrarFuncionarios()">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 328 328" xml:space="preserve">
                        <g id="XMLID_455_">
                            <path id="XMLID_458_"
                                d="M15,286.75h125.596c19.246,24.348,49.031,40,82.404,40c57.897,0,105-47.103,105-105s-47.103-105-105-105 c-34.488,0-65.145,16.716-84.298,42.47c-7.763-1.628-15.694-2.47-23.702-2.47c-63.411,0-115,51.589-115,115 C0,280.034,6.716,286.75,15,286.75z M223,146.75c41.355,0,75,33.645,75,75s-33.645,75-75,75s-75-33.645-75-75 S181.645,146.75,223,146.75z" />
                            <path id="XMLID_461_"
                                d="M115,1.25c-34.602,0-62.751,28.15-62.751,62.751S80.398,126.75,115,126.75 c34.601,0,62.75-28.148,62.75-62.749S149.601,1.25,115,1.25z" />
                            <path id="XMLID_462_"
                                d="M193,236.75h15v15c0,8.284,6.716,15,15,15s15-6.716,15-15v-15h15c8.284,0,15-6.716,15-15s-6.716-15-15-15 h-15v-15c0-8.284-6.716-15-15-15s-15,6.716-15,15v15h-15c-8.284,0-15,6.716-15,15S184.716,236.75,193,236.75z" />
                        </g>
                    </svg>
                    <div class="caixa">
                        <p>Cadastrar</p>
                    </div>
                </button>


                <button class="select-aside" onclick="alerta()">
                    <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                        text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                        clip-rule="evenodd" viewBox="0 0 511.999 463.377">
                        <path
                            d="M289.639 9.137c12.411 7.25 23.763 18.883 33.037 34.913l.97 1.813 1.118 1.941 174.174 302.48c33.712 56.407-1.203 113.774-66.174 112.973v.12H73.485c-.895 0-1.78-.04-2.657-.112-59.104-.799-86.277-54.995-61.909-106.852.842-1.805 1.816-3.475 2.816-5.201L189.482 43.959l-.053-.032c9.22-15.786 20.717-27.457 33.411-34.805C243.788-3 268.711-3.086 289.639 9.137zM255.7 339.203c13.04 0 23.612 10.571 23.612 23.612 0 13.041-10.572 23.613-23.612 23.613-13.041 0-23.613-10.572-23.613-23.613s10.572-23.612 23.613-23.612zm17.639-35.379c-.794 19.906-34.506 19.931-35.278-.006-3.41-34.108-12.129-111.541-11.853-143.591.284-9.874 8.469-15.724 18.939-17.955 3.231-.686 6.781-1.024 10.357-1.019 3.595.008 7.153.362 10.387 1.051 10.818 2.303 19.309 8.392 19.309 18.446l-.043 1.005-11.818 142.069zM37.596 369.821L216.864 59.942c21.738-37.211 56.225-38.289 78.376 0l176.298 306.166c17.177 28.285 10.04 66.236-38.774 65.488H73.485c-33.017.756-52.841-25.695-35.889-61.775z" />
                    </svg>
                    <div class="caixa">
                        <p>Alertas </Em></p>
                    </div>
                </button>

                <button class="select-aside" onclick="suporte()">
                    <svg fill="#000000" height="200px" width="200px" version="1.1" id="Capa_1"
                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        viewBox="0 0 611.999 611.999" xml:space="preserve" data-darkreader-inline-fill=""
                        style="--darkreader-inline-fill: var(--darkreader-background-000000, #000000);">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <g>
                                <g>
                                    <path
                                        d="M570.416,562.822c-5.758-109.379-104.063-154.627-104.063-154.627c-23.487-10.982-66.07-32.48-93.989-46.691 c35.77-39.134,46.335-102.939,47.98-112.018c7.465-41.08,3.708-91.926,3.708-91.926C417.226,58.685,317.399,57.132,306.945,57.236 c-0.577,0-0.952,0.006-0.952,0.006s-0.319-0.006-0.792,0c-9.478-0.123-110.404,0.878-117.267,100.318 c0,0-3.757,50.84,3.708,91.926c0.485,2.646,1.75,10.018,4.15,19.987c18.803,24.684,47.832,36.789,71.657,42.713 c2.996-2.91,7.078-4.721,11.602-4.721h43.425c9.19,0,16.63,7.446,16.63,16.636c0,9.196-7.44,16.648-16.63,16.648h-43.425 c-6.857,0-12.719-4.137-15.279-10.037c-17.771-4.322-38.336-11.848-56.691-24.794c7.323,19.011,17.759,39.404,32.553,55.592 c-27.919,14.211-70.484,35.702-93.989,46.685c0,0-98.292,45.248-104.063,154.627c0,0-1.707,18.189,32.762,25.076 c0,0,105.597,24.1,231.661,24.1c126.076,0,231.673-24.1,231.673-24.1C572.141,581.011,570.416,562.822,570.416,562.822z">
                                    </path>
                                    <path
                                        d="M154.147,284.944h10.491V161.722c0.025-0.307,0.098-0.602,0.098-0.915v-18.195c0-32.437,10.012-58.729,29.76-78.151 c40.847-40.19,110.619-39.643,111.797-39.478c0.829-0.061,70.018-1.056,111.048,39.103c19.883,19.46,29.969,45.874,29.969,78.526 v19.239c0,0.19,0.049,0.362,0.049,0.546v122.546h10.491c25.819,0,46.746-20.927,46.746-46.74v-44.923 c0-20.767-13.56-38.348-32.308-44.432v-6.231c0-39.619-12.615-72.043-37.47-96.377C386.361-1.186,308.958,0.042,306.251,0.005 c-3.253-0.031-80.73-0.982-129.164,46.531c-24.769,24.309-37.335,56.635-37.335,96.076v6.206 c-18.772,6.083-32.345,23.677-32.345,44.456v44.923C107.408,264.017,128.34,284.944,154.147,284.944z">
                                    </path>
                                </g>
                            </g>
                        </g>
                    </svg>
                    <div class="caixa">
                        <p>Suporte </Em></p>
                    </div>
                </button>

                <button class="select-aside" onclick="sair()">
                    <svg width="800px" height="800px" viewBox="0 0 24 24" fill="none"
                        xmlns="http://www.w3.org/2000/svg">

                        <g id="SVGRepo_bgCarrier" stroke-width="0" />

                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                        <g id="SVGRepo_iconCarrier">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M9.70725 2.4087C9 3.03569 9 4.18259 9 6.4764V17.5236C9 19.8174 9 20.9643 9.70725 21.5913C10.4145 22.2183 11.4955 22.0297 13.6576 21.6526L15.9864 21.2465C18.3809 20.8288 19.5781 20.62 20.2891 19.7417C21 18.8635 21 17.5933 21 15.0529V8.94711C21 6.40671 21 5.13652 20.2891 4.25826C19.5781 3.37999 18.3809 3.17118 15.9864 2.75354L13.6576 2.34736C11.4955 1.97026 10.4145 1.78171 9.70725 2.4087ZM12 10.1686C12.4142 10.1686 12.75 10.52 12.75 10.9535V13.0465C12.75 13.48 12.4142 13.8314 12 13.8314C11.5858 13.8314 11.25 13.48 11.25 13.0465V10.9535C11.25 10.52 11.5858 10.1686 12 10.1686Z"
                                fill="#000" />
                            <path
                                d="M7.54717 4.5C5.48889 4.503 4.41599 4.54826 3.73223 5.23202C3 5.96425 3 7.14276 3 9.49979V14.4998C3 16.8568 3 18.0353 3.73223 18.7676C4.41599 19.4513 5.48889 19.4966 7.54717 19.4996C7.49985 18.8763 7.49992 18.1557 7.50001 17.3768V6.6227C7.49992 5.84388 7.49985 5.1233 7.54717 4.5Z"
                                fill="#000" />
                        </g>

                    </svg>
                    <div class="caixa">
                        <p>Sair</p>
                    </div>
                </button>


            </ul>
        </aside>
    </div>

    <div class="coluna">
        <nav id="nav_kpis">
            <div class="kpiDash">
                <div class="imagem">
                    <img src="assets/imgs/alert-icon.svg" alt="">
                </div>
                <div class="texto">
                    SENSORES EM ALERTA
                    <span id="kpi_alerta"></span>
                </div>
            </div>

            <div class="kpiDash">
                <div class="imagem">
                    <img src="assets/imgs/areas_icon.svg" alt="">
                </div>
                <div class="texto">
                    QUANTIDADE DE AREAS AFETADAS
                    <span id="kpi_areas"></span>
                </div>
            </div>

            <div class="kpiDash">
                <div class="co2_alto">
                </div>
                <p class="texto">
                    SENSORES COM O CO2 ACIMA DO IDEAL
                    <span id="kpi_ppmAcima"></span>
                </p>
            </div>

            <div class="kpiDash">
                <div class="co2_baixo">
                </div>
                <p class="texto">
                    SENSORES COM O CO2 ABAIXO DO IDEAL
                    <span id="kpi_ppmAbaixo"></span>
                </p>
            </div>
        </nav>
        <nav id="nav_alertas">
            <div class="retangulo">
                <div class="vermelho">Menor que 300 <br> Ppm</div>
                <div class="amarelo">Entre 300 a 500 Ppm</div>
                <div class="verde">Entre 500 a 800 Ppm</div>
                <div class="amarelo">Entre 800 a 1000 Ppm</div>
                <div class="vermelho">Maior que 1000 Ppm</div>
            </div>
        </nav>

        <main>

            <a href="dashboard.html" id="voltarSensor1" class="seta-retorno" title="Voltar">
            </a>

            <a class="seta-retorno" id="voltarGrafico" onclick="voltarGrafico()">
            </a>

            <div class="noScroll" id="noScroll">
                <div class="sensores" id="sensores">
                    <div class="titulo">
                        <h1 id="dadosSensores"></h1>
                    </div>
                    <div class="containerSensores" id="containerSensores">
                    </div>
                </div>
            </div>
            <div class="grafico" id="grafico">
                <div class="titulo">
                    <h1 id="dadosGraficos"></h1>
                </div>

                <div class="informacoes">
                    <p>HOR√ÅRIO DE MEDI√á√ÉO: <span id="spanHorario"></span></p>
                    <p>DATA DA MEDI√á√ÉO: <span id="spanData"></span></p>
                </div>
                <div class="telaGrafico">
                    <canvas id="sensorAnalogico"></canvas>
                </div>
            </div>
        </main>
    </div>

    <script src="assets/js/dash.js"></script>

    <script>

        var valor1 = 0
        var valor2 = 0
        var valor3 = 0
        var valor4 = 0
        var valor5 = 0
        var valor6 = 0
        var valor7 = 0
        var valor8 = 0
        var valor9 = 0
        var valor10 = 0

        var sensorAnalogico = new Chart(document.getElementById('sensorAnalogico').getContext('2d'), {
            type: 'line',
            data: {
                labels: ['¬≠', '¬≠','¬≠','¬≠','¬≠','¬≠','¬≠','¬≠','¬≠','¬≠'],
                datasets: [
                    {
                        label: 'CO¬≤',
                        data: [valor1, valor2, valor3, valor4, valor5, valor6, valor7, valor8, valor9, valor10],
                        borderColor: '#38B622',
                        backgroundColor: '#38B622'
                    },
                    {
                        label: 'ATEN√á√ÉO',
                        data: [800, 800, 800, 800, 800, 800, 800, 800, 800, 800],
                        borderColor: '#fea603',
                        fill: false,
                        pointBorderWidth: 0,
                        pointRadius: 0,
                        backgroundColor: '#fea603'
                    },
                    {
                        label: 'CR√çTICO',
                        data: [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000],
                        borderColor: '#FF0000',
                        fill: false,
                        pointBorderWidth: 0,
                        pointRadius: 0,
                        backgroundColor: '#FF0000'
                    },
                    {
                        label: 'ATEN√á√ÉO',
                        data: [500, 500, 500, 500, 500, 500, 500, 500, 500, 500],
                        borderColor: '#fea603',
                        fill: false,
                        pointBorderWidth: 0,
                        pointRadius: 0,
                        backgroundColor: '#fea603'
                    },
                    {
                        label: 'CR√çTICO',
                        data: [300, 300, 300, 300, 300, 300, 300, 300, 300, 300],
                        borderColor: '#FF0000',
                        fill: false,
                        pointBorderWidth: 0,
                        pointRadius: 0,
                        backgroundColor: '#FF0000'
                    },

                ]
            },
            options: {
                plugins: {
                    title: {
                        display: true,
                        text: 'N√≠vel de CO¬≤',
                        font: {
                            size: 18
                        },
                        color: 'black',
                        padding: {
                            top: 1,
                            bottom: 3
                        }
                    }
                },
                scales: {
                    y: {
                        min: 0,
                        max: 1500,
                        title: {
                            display: true,
                            text: 'PPM'
                        }
                    }
                }
            }
        });

        function buscarDados() {

            fetch(`/sensores/buscarDados`, {
                method: 'GET'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Erro ao buscar sensores");
                    }
                    return response.json();
                })
                .then(sensores => {
                    const sensor0 = sensores[0];
                    valor1 = sensor0.qtdPpm;

                    const sensor1 = sensores[1];
                    valor2 = sensor1.qtdPpm;

                    const sensor2 = sensores[2];
                    valor3 = sensor2.qtdPpm;

                    const sensor3 = sensores[3];
                    valor4 = sensor3.qtdPpm;

                    const sensor4 = sensores[4];
                    valor5 = sensor4.qtdPpm;

                    const sensor5 = sensores[5];
                    valor6 = sensor5.qtdPpm;

                    const sensor6 = sensores[6];
                    valor7 = sensor6.qtdPpm;

                    const sensor7 = sensores[7];
                    valor8 = sensor7.qtdPpm;

                    const sensor8 = sensores[8];
                    valor9 = sensor8.qtdPpm;

                    const sensor9 = sensores[9];
                    valor10 = sensor9.qtdPpm;

                    spanHorario.innerHTML = sensor0.horaRegistro

                    sensorAnalogico.data.datasets[0].data = [valor10, valor9, valor8, valor7, valor6, valor5, valor4, valor3, valor2, valor1];
                    sensorAnalogico.update();
                })
                .catch(error => {
                    console.error("Erro ao buscar sensores:", error);
                });


            spanData.innerHTML = `06/06/2025`
        }

    </script>

</body>

</html>

<script>

    var area = [];

    window.onload = function () {
        buscarDados();
        kpiviv_1();
        kpiviv_2();
        kpiviv_3();
        kpiviv_4();
        listar();
        setInterval(buscarDados, 800);
        setInterval(kpiviv_1, 1000);
        setInterval(kpiviv_2, 1000);
        setInterval(kpiviv_3, 1000);
        setInterval(kpiviv_4, 1000);
        setInterval(listar, 1000)
        document.getElementById('nav_alertas').style.display = 'none'

    }

    function listar() {


        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        const idviveiro = getQueryParam('id');
        const idEmpresa = localStorage.getItem("idEmpresa");

        fetch(`/sensores/listar/${idviveiro}/${idEmpresa}`, {
            method: 'GET'
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Erro ao buscar sensores");
                }
                return response.json();
            })
            .then(sensores => {
                const container = document.getElementById("containerSensores");
                container.innerHTML = "";

                sensores.forEach(sensor => {

                    dadosSensores.innerHTML = `VIVEIRO ${(sensor.nomeViveiro).toUpperCase()} - ${(sensor.areaSensor).toUpperCase()}`
                    dadosGraficos.innerHTML = `SENSOR ${(sensor.nomeSensor).toUpperCase()}`

                    if (sensor.qtdPpm < 300 || sensor.qtdPpm > 1000) {
                        container.innerHTML += `
                    <button class="card-sensores" onclick="grafico()">
                        <div class="bolinha" style="background-color: red; width: 20px; height: 20px; border-radius: 50%; position: relative; left: -5.5%;"></div>
                        <p>SENSOR ${sensor.nomeSensor}<br>
                        √ÅREA: <span>${sensor.areaSensor}</span></p>
                    </button>
                    `;
                    } else if (sensor.qtdPpm < 500 || sensor.qtdPpm > 800) {
                        container.innerHTML += `
                    <button class="card-sensores" onclick="grafico()">
                        <div class="bolinha" style="background-color: #fea603; width: 20px; height: 20px; border-radius: 50%; position: relative; left: -5.5%;"></div>
                        <p>SENSOR ${sensor.nomeSensor}<br>
                        √ÅREA: <span>${sensor.areaSensor}</span></p>
                    </button>
                    `;
                    }

                    else if (sensor.qtdPpm > 500 || sensor.qtdPpm < 800) {
                        container.innerHTML += `
                    <button class="card-sensores" onclick="grafico()">
                        <div class="bolinha" style="background-color: green; width: 20px; height: 20px; border-radius: 50%; position: relative; left: -5.5%;"></div>
                        <p>SENSOR ${sensor.nomeSensor}<br>
                        √ÅREA: <span>${sensor.areaSensor}</span></p>
                    </button>
                    `;
                    }
                });
            })
            .catch(error => {
                console.error("Erro ao buscar sensores:", error);
            });
    }

    function kpiviv_1() {

        var contalert = 0;

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
        const idviveiro = getQueryParam('id');

        var id = sessionStorage.ID_USUARIO;

        fetch(`/viveiros/kpiviv_1/${id}/${idviveiro}`, {
            method: "GET"
        })
            .then(res => res.json())
            .then(kpiviv => {


                kpiviv.forEach(kpiviv => {

                    if (Number(kpiviv.qtdPpm) > 800 || Number(kpiviv.qtdPpm) < 500) {

                        contalert++;

                    }

                    kpi_alerta.innerHTML = contalert;
                });



            })
            .catch(erro => {
                console.error("Erro ao carregar o hist√≥rico:", erro);
            });


    }



    function kpiviv_2() {

        area = [];

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
        const idviveiro = getQueryParam('id');

        var id = sessionStorage.ID_USUARIO;



        fetch(`/viveiros/kpiviv_2/${id}/${idviveiro}`, {
            method: "GET"
        })
            .then(res => res.json())
            .then(kpiviv2 => {


                kpiviv2.forEach(kpiviv2 => {

                    if (Number(kpiviv2.qtdPpm < 500 || kpiviv2.qtdPpm > 800)) {

                        var areasen = kpiviv2.areaSensor;

                        if (!area.includes(areasen)) {

                            area.push(areasen);
                        }
                    }

                });

                kpi_areas.innerHTML = area.length;

            })
            .catch(erro => {
                console.error("Erro ao carregar o hist√≥rico:", erro);
            });
    }
    function kpiviv_3() {


        var contacima = 0;

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
        const idviveiro = getQueryParam('id');

        var id = sessionStorage.ID_USUARIO;



        fetch(`/viveiros/kpiviv_3/${id}/${idviveiro}`, {
            method: "GET"
        })
            .then(res => res.json())
            .then(kpiviv3 => {


                kpiviv3.forEach(kpiviv3 => {

                    if (Number(kpiviv3.qtdPpm) > 800) {

                        contacima++;

                    }

                    kpi_ppmAcima.innerHTML = contacima;

                });



            })
            .catch(erro => {
                console.error("Erro ao carregar o hist√≥rico:", erro);
            });




    }


    function kpiviv_4() {

        var contabaixo = 0;

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
        const idviveiro = getQueryParam('id');

        var id = sessionStorage.ID_USUARIO;



        fetch(`/viveiros/kpiviv_4/${id}/${idviveiro}`, {
            method: "GET"
        })
            .then(res => res.json())
            .then(kpiviv4 => {


                kpiviv4.forEach(kpiviv4 => {


                    if (Number(kpiviv4.qtdPpm) < 500) {

                        contabaixo++;

                    }

                    kpi_ppmAbaixo.innerHTML = contabaixo;

                });



            })
            .catch(erro => {
                console.error("Erro ao carregar o hist√≥rico:", erro);
            });

    }


</script>